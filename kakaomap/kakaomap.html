<!-- <!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Kakao 지도 API 테스트2</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=b161607ed1a03f4e998f738c9ad3d6cd"></script>
    <style>
        body, html {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        var container = document.getElementById('map'); // 지도를 담을 영역의 DOM 레퍼런스
        var options = {
            center: new kakao.maps.LatLng(37.5665, 126.9780), // 지도의 중심좌표
            level: 3 // 확대 레벨
        };
        var map = new kakao.maps.Map(container, options); // 지도 생성

        // 브라우저 창 크기 변경 시 지도 크기 재조정
        window.addEventListener('resize', function() {
            map.relayout();
        });
    </script>
</body>
</html> -->

<!-- <!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>현위치 지도 표시</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=b161607ed1a03f4e998f738c9ad3d6cd"></script>
    <style>
        body, html {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        // 1. Geolocation API를 사용해 사용자의 현재 위치 가져오기
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                // 사용자의 현재 위치 좌표
                var lat = position.coords.latitude; // 위도
                var lng = position.coords.longitude; // 경도

                // 2. Kakao 지도 생성
                var container = document.getElementById('map');
                var options = {
                    center: new kakao.maps.LatLng(lat, lng), // 현위치를 중심 좌표로 설정
                    level: 3 // 확대 레벨
                };

                var map = new kakao.maps.Map(container, options);

                // 3. 현위치에 마커 표시
                var markerPosition = new kakao.maps.LatLng(lat, lng); // 마커 위치
                var marker = new kakao.maps.Marker({
                    position: markerPosition
                });
                marker.setMap(map);

                // 4. 마커 위에 인포윈도우 추가 (선택 사항)
                var infoWindow = new kakao.maps.InfoWindow({
                    content: '<div style="padding:5px;">현재 위치</div>'
                });
                infoWindow.open(map, marker);

            }, function(error) {
                // 에러 처리
                alert('위치 정보를 가져올 수 없습니다: ' + error.message);
            });
        } else {
            alert('Geolocation API를 지원하지 않는 브라우저입니다.');
        }
    </script>
</body>
</html> -->

<!-- <!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>뱅뱅막국수 정보</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=b161607ed1a03f4e998f738c9ad3d6cd"></script>
    <style>
        body, html {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100%;
            height: 100%;
        }
        .info-content {
            background-color: #ffffff;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 10px;
            text-align: left;
            width: 400px; /* InfoWindow의 너비 */
            font-family: Arial, sans-serif;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1); /* 그림자 효과 */
        }
        .info-content h4 {
            margin-bottom: 10px;
            font-size: 18px;
            color: #333;
        }
        .info-content img {
            width: 100%;
            height: auto;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .info-content .details {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }
        .info-content .rating {
            font-size: 16px;
            color: #f39c12;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .info-content .phone, .info-content .menu, .info-content .address, .info-content .hours {
            margin-top: 5px;
        }
        .info-content .label {
            font-weight: bold;
            color: #333;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        // 1. 고정된 현위치 설정
        var lat = 37.4896537373705; // 고정 위도
        var lng = 127.032839070004; // 고정 경도
        var userLocation = new kakao.maps.LatLng(lat, lng);

        // 2. 지도 생성
        var mapContainer = document.getElementById('map');
        var mapOption = {
            center: userLocation,
            level: 4 // 확대 레벨
        };
        var map = new kakao.maps.Map(mapContainer, mapOption);

        // 3. 현위치 마커 표시
        var userMarker = new kakao.maps.Marker({
            position: userLocation,
            map: map
        });

        // 현위치 인포윈도우
        var userInfoWindow = new kakao.maps.InfoWindow({
            content: '<div style="padding:5px;">현위치</div>'
        });
        userInfoWindow.open(map, userMarker);

        // 4. 반경 200m 원 표시 (고정된 위치)
        var circle = new kakao.maps.Circle({
            center: userLocation,
            radius: 200, // 반경 200m
            strokeWeight: 2,
            strokeColor: '#FF0000',
            strokeOpacity: 0.8,
            fillColor: '#FF0000',
            fillOpacity: 0.2
        });
        circle.setMap(map);

        // 5. 뱅뱅막국수 데이터 마커 표시
        var restaurantData = [
            {
                name: "뱅뱅막국수 역삼본점",
                type: "국수",
                rating: "4.4",
                lat: 37.48965570000001,
                lng: 127.0328555,
                img: "http://localhost:8080/bangbang_menu.jpg",
                phone: "0507-1392-4848",
                menu: "뱅뱅막국수, 들기름막국수, 육전",
                address: "서울 강남구 도곡로 112 서한빌딩 1층 103호",
                hours: "매일 11:00 ~ 21:00, 매일 휴게시간 15:00 ~ 16:30"
            }
        ];

        // 전역 변수로 InfoWindow 객체 관리
        var activeInfoWindow = null;

        restaurantData.forEach(function(restaurant) {
            var marker = new kakao.maps.Marker({
                position: new kakao.maps.LatLng(restaurant.lat, restaurant.lng),
                map: map
            });

            // 마커 클릭 이벤트
            kakao.maps.event.addListener(marker, 'click', function() {
                // 열려 있는 InfoWindow가 있으면 닫기
                if (activeInfoWindow) {
                    activeInfoWindow.close();
                    if (activeInfoWindow.getPosition().equals(marker.getPosition())) {
                        activeInfoWindow = null;
                        return;
                    }
                }

                // 새로운 InfoWindow 생성 및 열기
                var infoWindow = new kakao.maps.InfoWindow({
                    content: `
                        <div class="info-content">
                            <h4>${restaurant.name}</h4>
                            <div class="rating">⭐ ${restaurant.rating}</div>
                            <img src="${restaurant.img}" alt="${restaurant.name}">
                            <div class="details">
                                <div class="type"><span class="label">업종:</span> ${restaurant.type}</div>
                                <div class="phone"><span class="label">전화번호:</span> ${restaurant.phone}</div>
                                <div class="menu"><span class="label">대표 메뉴:</span> ${restaurant.menu}</div>
                                <div class="address"><span class="label">주소:</span> ${restaurant.address}</div>
                                <div class="hours"><span class="label">영업시간:</span> ${restaurant.hours}</div>
                            </div>
                        </div>
                    `
                });
                infoWindow.open(map, marker);
                activeInfoWindow = infoWindow;
            });
        });

    </script>
</body>
</html> -->

<!-- <!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>뱅뱅막국수 정보</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=b161607ed1a03f4e998f738c9ad3d6cd"></script>
    <style>
        body, html {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100%;
            height: 100%;
        }
        .info-content {
            background-color: #ffffff;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 10px;
            text-align: left;
            width: 400px; /* InfoWindow의 너비 */
            font-family: Arial, sans-serif;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1); /* 그림자 효과 */
        }
        .info-content h4 {
            margin-bottom: 10px;
            font-size: 18px;
            color: #333;
        }
        .info-content img {
            width: 100%;
            height: auto;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .info-content .details {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }
        .info-content .rating {
            font-size: 16px;
            color: #f39c12;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .info-content .phone, .info-content .menu, .info-content .address, .info-content .hours {
            margin-top: 5px;
        }
        .info-content .label {
            font-weight: bold;
            color: #333;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        // 1. 고정된 현위치 설정
        var lat = 37.4896537373705; // 고정 위도
        var lng = 127.032839070004; // 고정 경도
        var userLocation = new kakao.maps.LatLng(lat, lng);

        // 2. 지도 생성
        var mapContainer = document.getElementById('map');
        var mapOption = {
            center: userLocation,
            level: 4 // 확대 레벨
        };
        var map = new kakao.maps.Map(mapContainer, mapOption);

        // 3. 현위치 마커 표시
        var userMarker = new kakao.maps.Marker({
            position: userLocation,
            map: map
        });

        // 현위치 인포윈도우
        var userInfoWindow = new kakao.maps.InfoWindow({
            content: '<div style="padding:5px;">현위치</div>'
        });
        userInfoWindow.open(map, userMarker);

        // 4. 반경 200m 원 표시 (고정된 위치)
        var circle = new kakao.maps.Circle({
            center: userLocation,
            radius: 200, // 반경 200m
            strokeWeight: 2,
            strokeColor: '#FF0000',
            strokeOpacity: 0.8,
            fillColor: '#FF0000',
            fillOpacity: 0.2
        });
        circle.setMap(map);

        // 5. 뱅뱅막국수 데이터 마커 표시
        var restaurantData = [
            {
                name: "뱅뱅막국수 역삼본점",
                type: "국수",
                rating: "4.4",
                lat: 37.48965570000001,
                lng: 127.0328555,
                img: "http://localhost:8080/bangbang_menu.jpg",
                phone: "0507-1392-4848",
                menu: "뱅뱅막국수, 들기름막국수, 육전",
                address: "서울 강남구 도곡로 112 서한빌딩 1층 103호",
                hours: "매일 11:00 ~ 21:00, 매일 휴게시간 15:00 ~ 16:30"
            }
        ];

        // 전역 변수로 InfoWindow 객체 관리
        var activeInfoWindow = null;

        restaurantData.forEach(function(restaurant) {
            var marker = new kakao.maps.Marker({
                position: new kakao.maps.LatLng(restaurant.lat, restaurant.lng),
                map: map
            });

            // 마커 클릭 이벤트
            kakao.maps.event.addListener(marker, 'click', function() {
                // 열려 있는 InfoWindow가 있으면 닫기
                if (activeInfoWindow) {
                    activeInfoWindow.close();
                    if (activeInfoWindow.getPosition().equals(marker.getPosition())) {
                        activeInfoWindow = null;
                        return;
                    }
                }

                // 새로운 InfoWindow 생성 및 열기
                var infoWindow = new kakao.maps.InfoWindow({
                    content: `
                        <div class="info-content">
                            <h4>${restaurant.name}</h4>
                            <div class="rating">⭐ ${restaurant.rating}</div>
                            <img src="${restaurant.img}" alt="${restaurant.name}">
                            <div class="details">
                                <div class="type"><span class="label">업종:</span> ${restaurant.type}</div>
                                <div class="phone"><span class="label">전화번호:</span> ${restaurant.phone}</div>
                                <div class="menu"><span class="label">대표 메뉴:</span> ${restaurant.menu}</div>
                                <div class="address"><span class="label">주소:</span> ${restaurant.address}</div>
                                <div class="hours"><span class="label">영업시간:</span> ${restaurant.hours}</div>
                            </div>
                        </div>
                    `
                });
                infoWindow.open(map, marker);
                activeInfoWindow = infoWindow;
            });
        });

        // 지도 클릭 시 InfoWindow 닫기
        kakao.maps.event.addListener(map, 'click', function() {
            if (activeInfoWindow) {
                activeInfoWindow.close();
                activeInfoWindow = null;
            }
        });
    </script>
</body>
</html> -->


<!-- <!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>분석리포트 보기</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=b161607ed1a03f4e998f738c9ad3d6cd"></script>
    <style>
        body, html {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100%;
            height: 100%;
        }
        .info-content {
            background-color: #ffffff;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 10px;
            text-align: left;
            width: 400px;
            font-family: Arial, sans-serif;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        }
        .info-content h4 {
            margin-bottom: 10px;
            font-size: 18px;
            color: #333;
        }
        .info-content img {
            width: 100%;
            height: auto;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .info-content .details {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }
        .info-content .rating {
            font-size: 16px;
            color: #f39c12;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .info-content .phone, .info-content .menu, .info-content .address, .info-content .hours {
            margin-top: 5px;
        }
        .info-content .label {
            font-weight: bold;
            color: #333;
        }
        .info-content .btn {
            display: inline-block;
            margin-top: 10px;
            padding: 10px 15px;
            background-color: #007BFF;
            color: #ffffff;
            text-align: center;
            font-size: 14px;
            border-radius: 5px;
            text-decoration: none;
            cursor: pointer;
        }
        .info-content .btn:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        // 1. 고정된 현위치 설정
        var lat = 37.4896537373705; // 고정 위도
        var lng = 127.032839070004; // 고정 경도
        var userLocation = new kakao.maps.LatLng(lat, lng);

        // 2. 지도 생성
        var mapContainer = document.getElementById('map');
        var mapOption = {
            center: userLocation,
            level: 4
        };
        var map = new kakao.maps.Map(mapContainer, mapOption);

        // 3. 현위치 마커 표시
        var userMarker = new kakao.maps.Marker({
            position: userLocation,
            map: map
        });

        // 현위치 인포윈도우
        var userInfoWindow = new kakao.maps.InfoWindow({
            content: '<div style="padding:5px;">현위치</div>'
        });
        userInfoWindow.open(map, userMarker);

        // 4. 반경 200m 원 표시
        var circle = new kakao.maps.Circle({
            center: userLocation,
            radius: 200,
            strokeWeight: 2,
            strokeColor: '#FF0000',
            strokeOpacity: 0.8,
            fillColor: '#FF0000',
            fillOpacity: 0.2
        });
        circle.setMap(map);

        // 5. 음식점 데이터
        var restaurantData = [
            {
                name: "뱅뱅막국수 역삼본점",
                type: "국수",
                rating: "4.4",
                lat: 37.48965570000001,
                lng: 127.0328555,
                img: "http://localhost:8080/bangbang_menu.jpg",
                phone: "0507-1392-4848",
                menu: "뱅뱅막국수, 들기름막국수, 육전",
                address: "서울 강남구 도곡로 112 서한빌딩 1층 103호",
                hours: "매일 11:00 ~ 21:00, 매일 휴게시간 15:00 ~ 16:30",
                reviewAnalysis: "http://localhost:8080/bangbang_pos_review.jpg"
            }
        ];

        // 전역 변수로 InfoWindow 객체 관리
        var activeInfoWindow = null;

        restaurantData.forEach(function(restaurant) {
            var marker = new kakao.maps.Marker({
                position: new kakao.maps.LatLng(restaurant.lat, restaurant.lng),
                map: map
            });

            // 마커 클릭 이벤트
            kakao.maps.event.addListener(marker, 'click', function() {
                if (activeInfoWindow) {
                    activeInfoWindow.close();
                }

                // 기본 InfoWindow
                var infoWindow = new kakao.maps.InfoWindow({
                    content: `
                        <div class="info-content">
                            <h4>${restaurant.name}</h4>
                            <div class="rating">⭐ ${restaurant.rating}</div>
                            <img src="${restaurant.img}" alt="${restaurant.name}">
                            <div class="details">
                                <div class="type"><span class="label">업종:</span> ${restaurant.type}</div>
                                <div class="phone"><span class="label">전화번호:</span> ${restaurant.phone}</div>
                                <div class="menu"><span class="label">대표 메뉴:</span> ${restaurant.menu}</div>
                                <div class="address"><span class="label">주소:</span> ${restaurant.address}</div>
                                <div class="hours"><span class="label">영업시간:</span> ${restaurant.hours}</div>
                                <a class="btn" onclick="showReviewAnalysis(${restaurant.lat}, ${restaurant.lng}, '${restaurant.reviewAnalysis}')">분석리포트 보기</a>
                            </div>
                        </div>
                    `
                });
                infoWindow.open(map, marker);
                activeInfoWindow = infoWindow;
            });
        });

        // 리뷰 분석 InfoWindow 표시 함수
        function showReviewAnalysis(lat, lng, reviewImg) {
            if (activeInfoWindow) {
                activeInfoWindow.close();
            }

            var reviewWindow = new kakao.maps.InfoWindow({
                content: `
                    <div class="info-content">
                        <h4>리뷰 분석 리포트</h4>
                        <img src="${reviewImg}" alt="리뷰 분석">
                    </div>
                `,
                position: new kakao.maps.LatLng(lat, lng)
            });
            reviewWindow.open(map);
            activeInfoWindow = reviewWindow;
        }

        // 지도 클릭 시 InfoWindow 닫기
        kakao.maps.event.addListener(map, 'click', function() {
            if (activeInfoWindow) {
                activeInfoWindow.close();
                activeInfoWindow = null;
            }
        });
    </script>
</body>
</html> -->

<!-- <!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>카카오맵_분석리포트추가</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=b161607ed1a03f4e998f738c9ad3d6cd"></script>
    <style>
        body, html {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100%;
            height: 100%;
        }
        .info-content {
            background-color: #ffffff;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 10px;
            text-align: left;
            width: 400px;
            font-family: Arial, sans-serif;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        }
        .info-content h4 {
            margin-bottom: 10px;
            font-size: 18px;
            color: #333;
        }
        .info-content img {
            width: 100%;
            height: auto;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .info-content .details {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }
        .info-content .rating {
            font-size: 16px;
            color: #f39c12;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .info-content .phone, .info-content .menu, .info-content .address, .info-content .hours {
            margin-top: 5px;
        }
        .info-content .label {
            font-weight: bold;
            color: #333;
        }
        .info-content .btn {
            display: inline-block;
            margin-top: 10px;
            padding: 10px 15px;
            background-color: #007BFF;
            color: #ffffff;
            text-align: center;
            font-size: 14px;
            border-radius: 5px;
            text-decoration: none;
            cursor: pointer;
        }
        .info-content .btn:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        // 1. 고정된 현위치 설정
        var lat = 37.4896537373705; // 고정 위도
        var lng = 127.032839070004; // 고정 경도
        var userLocation = new kakao.maps.LatLng(lat, lng);

        // 2. 지도 생성
        var mapContainer = document.getElementById('map');
        var mapOption = {
            center: userLocation,
            level: 4
        };
        var map = new kakao.maps.Map(mapContainer, mapOption);

        // 3. 현위치 마커 표시
        var userMarker = new kakao.maps.Marker({
            position: userLocation,
            map: map
        });

        // 현위치 인포윈도우
        var userInfoWindow = new kakao.maps.InfoWindow({
            content: '<div style="padding:5px;">현위치</div>'
        });
        userInfoWindow.open(map, userMarker);

        // 4. 반경 200m 원 표시
        var circle = new kakao.maps.Circle({
            center: userLocation,
            radius: 200,
            strokeWeight: 2,
            strokeColor: '#FF0000',
            strokeOpacity: 0.8,
            fillColor: '#FF0000',
            fillOpacity: 0.2
        });
        circle.setMap(map);

        // 5. 음식점 데이터
        var restaurantData = [
            {
                name: "뱅뱅막국수 역삼본점",
                type: "국수",
                rating: "4.4",
                lat: 37.48965570000001,
                lng: 127.0328555,
                img: "http://localhost:8080/bangbang_menu.jpg",
                phone: "0507-1392-4848",
                menu: "뱅뱅막국수, 들기름막국수, 육전",
                address: "서울 강남구 도곡로 112 서한빌딩 1층 103호",
                hours: "매일 11:00 ~ 21:00, 매일 휴게시간 15:00 ~ 16:30",
                reviewAnalysis: "http://localhost:8080/bangbang_pos_review.jpg"
            }
        ];

        // 전역 변수로 InfoWindow 객체 관리
        var activeInfoWindow = null;
        var reviewInfoWindow = null;

        restaurantData.forEach(function(restaurant) {
            var marker = new kakao.maps.Marker({
                position: new kakao.maps.LatLng(restaurant.lat, restaurant.lng),
                map: map
            });

            // 마커 클릭 이벤트
            kakao.maps.event.addListener(marker, 'click', function() {
                if (activeInfoWindow) {
                    activeInfoWindow.close();
                }
                if (reviewInfoWindow) {
                    reviewInfoWindow.close();
                    reviewInfoWindow = null;
                }

                // 기본 InfoWindow
                var infoWindow = new kakao.maps.InfoWindow({
                    content: `
                        <div class="info-content">
                            <h4>${restaurant.name}</h4>
                            <div class="rating">⭐ ${restaurant.rating}</div>
                            <img src="${restaurant.img}" alt="${restaurant.name}">
                            <div class="details">
                                <div class="type"><span class="label">업종:</span> ${restaurant.type}</div>
                                <div class="phone"><span class="label">전화번호:</span> ${restaurant.phone}</div>
                                <div class="menu"><span class="label">대표 메뉴:</span> ${restaurant.menu}</div>
                                <div class="address"><span class="label">주소:</span> ${restaurant.address}</div>
                                <div class="hours"><span class="label">영업시간:</span> ${restaurant.hours}</div>
                                <a class="btn" onclick="showReviewAnalysis(${restaurant.lat}, ${restaurant.lng}, '${restaurant.reviewAnalysis}')">분석리포트 보기</a>
                            </div>
                        </div>
                    `
                });
                infoWindow.open(map, marker);
                activeInfoWindow = infoWindow;
            });
        });

        // 리뷰 분석 InfoWindow 표시 함수
        function showReviewAnalysis(lat, lng, reviewImg) {
            // 기존 리뷰 InfoWindow 닫기
            if (reviewInfoWindow) {
                reviewInfoWindow.close();
            }

            // 오른쪽에 InfoWindow 표시
            var reviewWindowPosition = new kakao.maps.LatLng(lat, lng + 0.0005); // 약간 오른쪽에 표시
            reviewInfoWindow = new kakao.maps.InfoWindow({
                content: `
                    <div class="info-content">
                        <h4>리뷰 분석 리포트</h4>
                        <img src="${reviewImg}" alt="리뷰 분석">
                    </div>
                `,
                position: reviewWindowPosition
            });
            reviewInfoWindow.open(map);
        }

        // 지도 클릭 시 InfoWindow 닫기
        kakao.maps.event.addListener(map, 'click', function() {
            if (activeInfoWindow) {
                activeInfoWindow.close();
                activeInfoWindow = null;
            }
            if (reviewInfoWindow) {
                reviewInfoWindow.close();
                reviewInfoWindow = null;
            }
        });
    </script>
</body>
</html> -->

<!-- <!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>카카오맵_리뷰모아보기</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=b161607ed1a03f4e998f738c9ad3d6cd"></script>
    <style>
        body, html {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100%;
            height: 100%;
        }
        .info-content {
            background-color: #ffffff;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 10px;
            text-align: left;
            width: 400px;
            font-family: Arial, sans-serif;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        }
        .info-content h4 {
            margin-bottom: 10px;
            font-size: 18px;
            color: #333;
        }
        .info-content img {
            width: 100%;
            height: auto;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .info-content .btn {
            display: inline-block;
            margin-top: 10px;
            padding: 10px 15px;
            background-color: #007BFF;
            color: #ffffff;
            text-align: center;
            font-size: 14px;
            border-radius: 5px;
            text-decoration: none;
            cursor: pointer;
        }
        .info-content .btn:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        var lat = 37.4896537373705; // 고정 위도
        var lng = 127.032839070004; // 고정 경도
        var userLocation = new kakao.maps.LatLng(lat, lng);

        var mapContainer = document.getElementById('map');
        var mapOption = {
            center: userLocation,
            level: 4
        };
        var map = new kakao.maps.Map(mapContainer, mapOption);

        var restaurantData = [
            {
                name: "뱅뱅막국수 역삼본점",
                type: "국수",
                rating: "4.4",
                lat: 37.48965570000001,
                lng: 127.0328555,
                img: "http://localhost:8080/bangbang_menu.jpg",
                reviewAnalysis: "http://localhost:8080/bangbang_pos_review.jpg",
                source: "kakao" // 리뷰 데이터 출처
            }
        ];

        var activeInfoWindow = null;
        var reviewInfoWindow = null;

        restaurantData.forEach(function (restaurant) {
            var marker = new kakao.maps.Marker({
                position: new kakao.maps.LatLng(restaurant.lat, restaurant.lng),
                map: map
            });

            kakao.maps.event.addListener(marker, 'click', function () {
                if (activeInfoWindow) {
                    activeInfoWindow.close();
                }
                if (reviewInfoWindow) {
                    reviewInfoWindow.close();
                    reviewInfoWindow = null;
                }

                var infoWindow = new kakao.maps.InfoWindow({
                    content: `
                        <div class="info-content">
                            <h4>${restaurant.name}</h4>
                            <div class="rating">⭐ ${restaurant.rating}</div>
                            <img src="${restaurant.img}" alt="${restaurant.name}">
                            <a class="btn" onclick="showReviewAnalysis(${restaurant.lat}, ${restaurant.lng}, '${restaurant.reviewAnalysis}')">분석리포트 보기</a>
                            <a class="btn" onclick="showAllReviews(${restaurant.lat}, ${restaurant.lng}, '${restaurant.source}')">리뷰모아보기</a>
                        </div>
                    `
                });
                infoWindow.open(map, marker);
                activeInfoWindow = infoWindow;
            });
        });

        function showReviewAnalysis(lat, lng, reviewImg) {
            if (reviewInfoWindow) {
                reviewInfoWindow.close();
            }

            var reviewWindowPosition = new kakao.maps.LatLng(lat, lng + 0.0005);
            reviewInfoWindow = new kakao.maps.InfoWindow({
                content: `
                    <div class="info-content">
                        <h4>리뷰 분석 리포트</h4>
                        <img src="${reviewImg}" alt="리뷰 분석">
                    </div>
                `,
                position: reviewWindowPosition
            });
            reviewInfoWindow.open(map);
        }

        function showAllReviews(lat, lng, source) {
            fetch(`http://127.0.0.1:5000/reviews?source=${source}`)
                .then((response) => response.json())
                .then((data) => {
                    let reviewsHtml = `<h4>${source.toUpperCase()} 리뷰 모아보기</h4>`;
                    if (data.length === 0) {
                        reviewsHtml += `<p>리뷰가 없습니다.</p>`;
                    } else {
                        data.forEach((review) => {
                            reviewsHtml += `
                                <div style="margin-bottom: 10px; border-bottom: 1px solid #ddd; padding: 5px;">
                                    <p><b>날짜:</b> ${review.Review_Date}</p>
                                    <p><b>리뷰:</b> ${review.Review}</p>
                                </div>
                            `;
                        });
                    }

                    var reviewWindowPosition = new kakao.maps.LatLng(lat, lng + 0.0005);
                    reviewInfoWindow = new kakao.maps.InfoWindow({
                        content: `
                            <div class="info-content" style="width: 400px;">
                                ${reviewsHtml}
                            </div>
                        `,
                        position: reviewWindowPosition
                    });
                    reviewInfoWindow.open(map);
                })
                .catch((error) => console.error('리뷰 데이터를 가져오는 중 오류 발생:', error));
        }
    </script>
</body>
</html> -->

<!-- <!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>카카오맵_리뷰모아보기</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=b161607ed1a03f4e998f738c9ad3d6cd"></script>
    <style>
        body, html {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100%;
            height: 100%;
        }
        .info-content {
            background-color: #ffffff;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 10px;
            text-align: left;
            width: 400px;
            font-family: Arial, sans-serif;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        }
        .info-content h4 {
            margin-bottom: 10px;
            font-size: 18px;
            color: #333;
        }
        .info-content img {
            width: 100%;
            height: auto;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .info-content .details {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }
        .info-content .rating {
            font-size: 16px;
            color: #f39c12;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .info-content .phone, .info-content .menu, .info-content .address, .info-content .hours {
            margin-top: 5px;
        }
        .info-content .label {
            font-weight: bold;
            color: #333;
        }
        .info-content .btn {
            display: inline-block;
            margin-top: 10px;
            padding: 10px 15px;
            background-color: #007BFF;
            color: #ffffff;
            text-align: center;
            font-size: 14px;
            border-radius: 5px;
            text-decoration: none;
            cursor: pointer;
        }
        .info-content .btn:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        var lat = 37.4896537373705;
        var lng = 127.032839070004;
        var userLocation = new kakao.maps.LatLng(lat, lng);

        var mapContainer = document.getElementById('map');
        var mapOption = {
            center: userLocation,
            level: 4
        };
        var map = new kakao.maps.Map(mapContainer, mapOption);

        var restaurantData = [
            {
                name: "뱅뱅막국수 역삼본점",
                type: "국수",
                rating: "4.4",
                lat: 37.48965570000001,
                lng: 127.0328555,
                img: "http://localhost:8080/bangbang_menu.jpg",
                phone: "0507-1392-4848",
                menu: "뱅뱅막국수, 들기름막국수, 육전",
                address: "서울 강남구 도곡로 112 서한빌딩 1층 103호",
                hours: "매일 11:00 ~ 21:00, 매일 휴게시간 15:00 ~ 16:30",
                reviewAnalysis: "http://localhost:8080/bangbang_pos_review.jpg",
                source: "kakao"
            }
        ];

        var activeInfoWindow = null;
        var reviewInfoWindow = null;

        restaurantData.forEach(function (restaurant) {
            var marker = new kakao.maps.Marker({
                position: new kakao.maps.LatLng(restaurant.lat, restaurant.lng),
                map: map
            });

            kakao.maps.event.addListener(marker, 'click', function () {
                if (activeInfoWindow) {
                    activeInfoWindow.close();
                }
                if (reviewInfoWindow) {
                    reviewInfoWindow.close();
                    reviewInfoWindow = null;
                }

                var infoWindow = new kakao.maps.InfoWindow({
                    content: `
                        <div class="info-content">
                            <h4>${restaurant.name}</h4>
                            <div class="rating">⭐ ${restaurant.rating}</div>
                            <img src="${restaurant.img}" alt="${restaurant.name}">
                            <div class="details">
                                <div class="type"><span class="label">업종:</span> ${restaurant.type}</div>
                                <div class="phone"><span class="label">전화번호:</span> ${restaurant.phone}</div>
                                <div class="menu"><span class="label">대표 메뉴:</span> ${restaurant.menu}</div>
                                <div class="address"><span class="label">주소:</span> ${restaurant.address}</div>
                                <div class="hours"><span class="label">영업시간:</span> ${restaurant.hours}</div>
                                <a class="btn" onclick="showReviewAnalysis(${restaurant.lat}, ${restaurant.lng}, '${restaurant.reviewAnalysis}')">분석리포트 보기</a>
                                <a class="btn" onclick="showAllReviews(${restaurant.lat}, ${restaurant.lng}, '${restaurant.source}')">리뷰모아보기</a>
                            </div>
                        </div>
                    `
                });
                infoWindow.open(map, marker);
                activeInfoWindow = infoWindow;
            });
        });

        function showReviewAnalysis(lat, lng, reviewImg) {
            if (reviewInfoWindow) {
                reviewInfoWindow.close();
            }

            var reviewWindowPosition = new kakao.maps.LatLng(lat, lng + 0.0005);
            reviewInfoWindow = new kakao.maps.InfoWindow({
                content: `
                    <div class="info-content">
                        <h4>리뷰 분석 리포트</h4>
                        <img src="${reviewImg}" alt="리뷰 분석">
                    </div>
                `,
                position: reviewWindowPosition
            });
            reviewInfoWindow.open(map);
        }

        function showAllReviews(lat, lng, source) {
            fetch(`http://127.0.0.1:5000/reviews?source=${source}`)
                .then((response) => response.json())
                .then((data) => {
                    let reviewsHtml = `<h4>${source.toUpperCase()} 리뷰 모아보기</h4>`;
                    if (data.length === 0) {
                        reviewsHtml += `<p>리뷰가 없습니다.</p>`;
                    } else {
                        data.forEach((review) => {
                            reviewsHtml += `
                                <div style="margin-bottom: 10px; border-bottom: 1px solid #ddd; padding: 5px;">
                                    <p><b>날짜:</b> ${review.Review_Date}</p>
                                    <p><b>리뷰:</b> ${review.Review}</p>
                                </div>
                            `;
                        });
                    }

                    var reviewWindowPosition = new kakao.maps.LatLng(lat, lng + 0.0007);
                    reviewInfoWindow = new kakao.maps.InfoWindow({
                        content: `
                            <div class="info-content" style="width: 400px;">
                                ${reviewsHtml}
                            </div>
                        `,
                        position: reviewWindowPosition
                    });
                    reviewInfoWindow.open(map);
                })
                .catch((error) => console.error('리뷰 데이터를 가져오는 중 오류 발생:', error));
        }
    </script>
</body>
</html> -->


<!-- <!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>카카오맵_리뷰모아보기</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=b161607ed1a03f4e998f738c9ad3d6cd"></script>
    <style>
        body, html {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100%;
            height: 100%;
        }
        .info-content {
            background-color: #ffffff;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 10px;
            text-align: left;
            width: 400px;
            font-family: Arial, sans-serif;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        }
        .info-content h4 {
            margin-bottom: 10px;
            font-size: 18px;
            color: #333;
        }
        .info-content img {
            width: 100%;
            height: auto;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .info-content .details {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }
        .info-content .btn {
            display: inline-block;
            margin-top: 10px;
            padding: 10px 15px;
            background-color: #007BFF;
            color: #ffffff;
            text-align: center;
            font-size: 14px;
            border-radius: 5px;
            text-decoration: none;
            cursor: pointer;
        }
        .info-content .btn:hover {
            background-color: #0056b3;
        }
        .review-container {
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        var lat = 37.4896537373705;
        var lng = 127.032839070004;
        var userLocation = new kakao.maps.LatLng(lat, lng);

        var mapContainer = document.getElementById('map');
        var mapOption = {
            center: userLocation,
            level: 4
        };
        var map = new kakao.maps.Map(mapContainer, mapOption);

        var restaurantData = [
            {
                name: "뱅뱅막국수 역삼본점",
                type: "국수",
                rating: "4.4",
                lat: 37.48965570000001,
                lng: 127.0328555,
                img: "http://localhost:8080/bangbang_menu.jpg",
                phone: "0507-1392-4848",
                menu: "뱅뱅막국수, 들기름막국수, 육전",
                address: "서울 강남구 도곡로 112 서한빌딩 1층 103호",
                hours: "매일 11:00 ~ 21:00, 매일 휴게시간 15:00 ~ 16:30",
                reviewAnalysis: "http://localhost:8080/bangbang_pos_review.jpg",
                source: "kakao"
            }
        ];

        var activeInfoWindow = null;
        var reviewInfoWindow = null;

        restaurantData.forEach(function (restaurant) {
            var marker = new kakao.maps.Marker({
                position: new kakao.maps.LatLng(restaurant.lat, restaurant.lng),
                map: map
            });

            kakao.maps.event.addListener(marker, 'click', function () {
                if (activeInfoWindow) {
                    activeInfoWindow.close();
                }
                if (reviewInfoWindow) {
                    reviewInfoWindow.close();
                    reviewInfoWindow = null;
                }

                var infoWindow = new kakao.maps.InfoWindow({
                    content: `
                        <div class="info-content">
                            <h4>${restaurant.name}</h4>
                            <div class="rating">⭐ ${restaurant.rating}</div>
                            <img src="${restaurant.img}" alt="${restaurant.name}">
                            <div class="details">
                                <div><b>업종:</b> ${restaurant.type}</div>
                                <div><b>전화번호:</b> ${restaurant.phone}</div>
                                <div><b>대표 메뉴:</b> ${restaurant.menu}</div>
                                <div><b>주소:</b> ${restaurant.address}</div>
                                <div><b>영업시간:</b> ${restaurant.hours}</div>
                                <a class="btn" onclick="showAllReviews(${restaurant.lat}, ${restaurant.lng}, '${restaurant.source}')">리뷰모아보기</a>
                            </div>
                        </div>
                    `
                });
                infoWindow.open(map, marker);
                activeInfoWindow = infoWindow;
            });
        });

        function showAllReviews(lat, lng, source) {
            fetch(`http://127.0.0.1:5000/reviews?source=${source}`)
                .then((response) => response.json())
                .then((data) => {
                    let reviewsHtml = `<h4>${source.toUpperCase()} 리뷰 모아보기</h4>`;
                    if (data.length === 0) {
                        reviewsHtml += `<p>리뷰가 없습니다.</p>`;
                    } else {
                        reviewsHtml += `
                            <div class="review-container">
                                ${generateReviewHTML(data.slice(0, 10))}
                            </div>
                        `;
                    }

                    var reviewWindowPosition = new kakao.maps.LatLng(lat, lng + 0.0007);
                    reviewInfoWindow = new kakao.maps.InfoWindow({
                        content: `
                            <div class="info-content" style="width: 400px;">
                                ${reviewsHtml}
                            </div>
                        `,
                        position: reviewWindowPosition
                    });
                    reviewInfoWindow.open(map);

                    // Scroll event for pagination
                    const reviewContainer = document.querySelector('.review-container');
                    if (reviewContainer) {
                        let currentPage = 1;
                        reviewContainer.addEventListener('scroll', function () {
                            if (reviewContainer.scrollTop + reviewContainer.clientHeight >= reviewContainer.scrollHeight) {
                                currentPage++;
                                const startIndex = (currentPage - 1) * 10;
                                const endIndex = startIndex + 10;
                                const nextReviews = data.slice(startIndex, endIndex);
                                if (nextReviews.length > 0) {
                                    reviewContainer.innerHTML += generateReviewHTML(nextReviews);
                                }
                            }
                        });
                    }
                })
                .catch((error) => console.error('리뷰 데이터를 가져오는 중 오류 발생:', error));
        }

        function generateReviewHTML(reviews) {
            return reviews
                .map(
                    (review) => `
                    <div style="margin-bottom: 10px; border-bottom: 1px solid #ddd; padding: 5px;">
                        <p><b>날짜:</b> ${review.Review_Date}</p>
                        <p><b>리뷰:</b> ${review.Review}</p>
                    </div>
                `
                )
                .join('');
        }
    </script>
</body>
</html> -->

 
<!-- <!DOCTYPE html> 최종
<html>
<head>
    <meta charset="utf-8">
    <title>카카오맵_리뷰와 분석리포트</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=b161607ed1a03f4e998f738c9ad3d6cd"></script>
    <style>
        body, html {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100%;
            height: 100%;
        }
        .info-content {
            background-color: #ffffff;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 10px;
            text-align: left;
            width: 400px;
            font-family: Arial, sans-serif;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        }
        .info-content h4 {
            margin-bottom: 10px;
            font-size: 18px;
            color: #333;
        }
        .info-content img {
            width: 100%;
            height: auto;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .info-content .details {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }
        .info-content .btn {
            display: inline-block;
            margin-top: 10px;
            padding: 10px 15px;
            background-color: #007BFF;
            color: #ffffff;
            text-align: center;
            font-size: 14px;
            border-radius: 5px;
            text-decoration: none;
            cursor: pointer;
        }
        .info-content .btn:hover {
            background-color: #0056b3;
        }
        .review-container {
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        // 1. 고정된 현위치 설정
        var lat = 37.4896537373705;
        var lng = 127.032839070004;
        var userLocation = new kakao.maps.LatLng(lat, lng);

        // 2. 지도 생성
        var mapContainer = document.getElementById('map');
        var mapOption = {
            center: userLocation,
            level: 4
        };
        var map = new kakao.maps.Map(mapContainer, mapOption);

        // 3. 현위치 마커 표시
        var userMarker = new kakao.maps.Marker({
            position: userLocation,
            map: map
        });

        // 현위치 인포윈도우
        var userInfoWindow = new kakao.maps.InfoWindow({
            content: '<div style="padding:5px;">현위치</div>'
        });
        userInfoWindow.open(map, userMarker);

        // 4. 반경 200m 원 표시
        var circle = new kakao.maps.Circle({
            center: userLocation,
            radius: 200,
            strokeWeight: 2,
            strokeColor: '#FF0000',
            strokeOpacity: 0.8,
            fillColor: '#FF0000',
            fillOpacity: 0.2
        });
        circle.setMap(map);

        // 5. 음식점 데이터
        var restaurantData = [
            {
                name: "뱅뱅막국수 역삼본점",
                type: "국수",
                rating: "4.4",
                lat: 37.48965570000001,
                lng: 127.0328555,
                img: "http://localhost:8080/bangbang_menu.jpg",
                phone: "0507-1392-4848",
                menu: "뱅뱅막국수, 들기름막국수, 육전",
                address: "서울 강남구 도곡로 112 서한빌딩 1층 103호",
                hours: "매일 11:00 ~ 21:00, 매일 휴게시간 15:00 ~ 16:30",
                reviewAnalysis: "http://localhost:8080/bangbang_pos_review.jpg",
                source: "kakao"
            }
        ];

        var activeInfoWindow = null;
        var reviewInfoWindow = null;

        restaurantData.forEach(function (restaurant) {
            var marker = new kakao.maps.Marker({
                position: new kakao.maps.LatLng(restaurant.lat, restaurant.lng),
                map: map
            });

            // 마커 클릭 이벤트
            kakao.maps.event.addListener(marker, 'click', function () {
                if (activeInfoWindow) {
                    activeInfoWindow.close();
                }
                if (reviewInfoWindow) {
                    reviewInfoWindow.close();
                    reviewInfoWindow = null;
                }

                var infoWindow = new kakao.maps.InfoWindow({
                    content: `
                        <div class="info-content">
                            <h4>${restaurant.name}</h4>
                            <div>⭐ ${restaurant.rating}</div>
                            <img src="${restaurant.img}" alt="${restaurant.name}">
                            <div class="details">
                                <div><b>업종:</b> ${restaurant.type}</div>
                                <div><b>전화번호:</b> ${restaurant.phone}</div>
                                <div><b>대표 메뉴:</b> ${restaurant.menu}</div>
                                <div><b>주소:</b> ${restaurant.address}</div>
                                <div><b>영업시간:</b> ${restaurant.hours}</div>
                                <a class="btn" onclick="showReviewAnalysis(${restaurant.lat}, ${restaurant.lng}, '${restaurant.reviewAnalysis}')">분석리포트 보기</a>
                                <a class="btn" onclick="showAllReviews(${restaurant.lat}, ${restaurant.lng}, '${restaurant.source}')">리뷰모아보기</a>
                            </div>
                        </div>
                    `
                });
                infoWindow.open(map, marker);
                activeInfoWindow = infoWindow;
            });
        });

        function showAllReviews(lat, lng, source) {
            fetch(`http://127.0.0.1:5000/reviews?source=${source}`)
                .then((response) => response.json())
                .then((data) => {
                    let reviewsHtml = `<h4>${source.toUpperCase()} 리뷰 모아보기</h4>`;
                    if (data.length === 0) {
                        reviewsHtml += `<p>리뷰가 없습니다.</p>`;
                    } else {
                        reviewsHtml += `
                            <div class="review-container">
                                ${generateReviewHTML(data.slice(0, 10))}
                            </div>
                        `;
                    }

                    var reviewWindowPosition = new kakao.maps.LatLng(lat, lng + 0.0007);
                    reviewInfoWindow = new kakao.maps.InfoWindow({
                        content: `
                            <div class="info-content" style="width: 400px;">
                                ${reviewsHtml}
                            </div>
                        `,
                        position: reviewWindowPosition
                    });
                    reviewInfoWindow.open(map);

                    // Scroll event for pagination
                    const reviewContainer = document.querySelector('.review-container');
                    if (reviewContainer) {
                        let currentPage = 1;
                        reviewContainer.addEventListener('scroll', function () {
                            if (reviewContainer.scrollTop + reviewContainer.clientHeight >= reviewContainer.scrollHeight) {
                                currentPage++;
                                const startIndex = (currentPage - 1) * 10;
                                const endIndex = startIndex + 10;
                                const nextReviews = data.slice(startIndex, endIndex);
                                if (nextReviews.length > 0) {
                                    reviewContainer.innerHTML += generateReviewHTML(nextReviews);
                                }
                            }
                        });
                    }
                })
                .catch((error) => console.error('리뷰 데이터를 가져오는 중 오류 발생:', error));
        }

        function generateReviewHTML(reviews) {
            return reviews
                .map(
                    (review) => `
                    <div style="margin-bottom: 10px; border-bottom: 1px solid #ddd; padding: 5px;">
                        <p><b>날짜:</b> ${review.Review_Date}</p>
                        <p><b>리뷰:</b> ${review.Review}</p>
                    </div>
                `
                )
                .join('');
        }

        function showReviewAnalysis(lat, lng, reviewImg) {
            if (reviewInfoWindow) {
                reviewInfoWindow.close();
            }

            var reviewWindowPosition = new kakao.maps.LatLng(lat, lng + 0.0005);
            reviewInfoWindow = new kakao.maps.InfoWindow({
                content: `
                    <div class="info-content">
                        <h4>리뷰 분석 리포트</h4>
                        <img src="${reviewImg}" alt="리뷰 분석">
                    </div>
                `,
                position: reviewWindowPosition
            });
            reviewInfoWindow.open(map);
        }
    </script>
</body>
</html> -->

<!-- <!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>카카오맵_구글/네이버/카카오 리뷰</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=b161607ed1a03f4e998f738c9ad3d6cd"></script>
    <style>
        body, html {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100%;
            height: 100%;
        }
        .info-content {
            background-color: #ffffff;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 10px;
            text-align: left;
            width: 400px;
            font-family: Arial, sans-serif;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        }
        .info-content h4 {
            margin-bottom: 10px;
            font-size: 18px;
            color: #333;
        }
        .info-content img {
            width: 100%;
            height: auto;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .info-content .details {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }
        .info-content .btn {
            display: inline-block;
            margin-top: 10px;
            padding: 10px 15px;
            background-color: #007BFF;
            color: #ffffff;
            text-align: center;
            font-size: 14px;
            border-radius: 5px;
            text-decoration: none;
            cursor: pointer;
        }
        .info-content .btn:hover {
            background-color: #0056b3;
        }
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
        }
        .tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-bottom: none;
        }
        .tab.active {
            background-color: #ffffff;
            font-weight: bold;
        }
        .tab-content {
            display: none;
            padding: 10px;
            border: 1px solid #ddd;
            border-top: none;
            background-color: #ffffff;
        }
        .tab-content.active {
            display: block;
        }
        .review-container {
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        // 1. 고정된 현위치 설정
        var lat = 37.4896537373705;
        var lng = 127.032839070004;
        var userLocation = new kakao.maps.LatLng(lat, lng);

        // 2. 지도 생성
        var mapContainer = document.getElementById('map');
        var mapOption = {
            center: userLocation,
            level: 4
        };
        var map = new kakao.maps.Map(mapContainer, mapOption);

        // 3. 현위치 마커 표시
        var userMarker = new kakao.maps.Marker({
            position: userLocation,
            map: map
        });

        // 현위치 인포윈도우
        var userInfoWindow = new kakao.maps.InfoWindow({
            content: '<div style="padding:5px;">현위치</div>'
        });
        userInfoWindow.open(map, userMarker);

        // 4. 반경 200m 원 표시
        var circle = new kakao.maps.Circle({
            center: userLocation,
            radius: 200,
            strokeWeight: 2,
            strokeColor: '#FF0000',
            strokeOpacity: 0.8,
            fillColor: '#FF0000',
            fillOpacity: 0.2
        });
        circle.setMap(map);

        // 5. 음식점 데이터
        var restaurantData = [
            {
                name: "뱅뱅막국수 역삼본점",
                type: "국수",
                rating: "4.4",
                lat: 37.48965570000001,
                lng: 127.0328555,
                img: "http://localhost:8080/bangbang_menu.jpg",
                phone: "0507-1392-4848",
                menu: "뱅뱅막국수, 들기름막국수, 육전",
                address: "서울 강남구 도곡로 112 서한빌딩 1층 103호",
                hours: "매일 11:00 ~ 21:00, 매일 휴게시간 15:00 ~ 16:30"
            }
        ];

        var activeInfoWindow = null;
        var reviewInfoWindow = null;

        restaurantData.forEach(function (restaurant) {
            var marker = new kakao.maps.Marker({
                position: new kakao.maps.LatLng(restaurant.lat, restaurant.lng),
                map: map
            });

            // 마커 클릭 이벤트
            kakao.maps.event.addListener(marker, 'click', function () {
                if (activeInfoWindow) {
                    activeInfoWindow.close();
                }
                if (reviewInfoWindow) {
                    reviewInfoWindow.close();
                    reviewInfoWindow = null;
                }

                var infoWindow = new kakao.maps.InfoWindow({
                    content: `
                        <div class="info-content">
                            <h4>${restaurant.name}</h4>
                            <div>⭐ ${restaurant.rating}</div>
                            <img src="${restaurant.img}" alt="${restaurant.name}">
                            <div class="details">
                                <div><b>업종:</b> ${restaurant.type}</div>
                                <div><b>전화번호:</b> ${restaurant.phone}</div>
                                <div><b>대표 메뉴:</b> ${restaurant.menu}</div>
                                <div><b>주소:</b> ${restaurant.address}</div>
                                <div><b>영업시간:</b> ${restaurant.hours}</div>
                                <a class="btn" onclick="showAllReviews(${restaurant.lat}, ${restaurant.lng})">리뷰모아보기</a>
                            </div>
                        </div>
                    `
                });
                infoWindow.open(map, marker);
                activeInfoWindow = infoWindow;
            });
        });

        function showAllReviews(lat, lng) {
            const reviewWindowPosition = new kakao.maps.LatLng(lat, lng + 0.0007);
            reviewInfoWindow = new kakao.maps.InfoWindow({
                content: `
                    <div class="info-content">
                        <div class="tabs">
                            <div class="tab active" onclick="showTab('kakao')">카카오 리뷰</div>
                            <div class="tab" onclick="showTab('naver')">네이버 리뷰</div>
                            <div class="tab" onclick="showTab('google')">구글 리뷰</div>
                        </div>
                        <div class="tab-content active" id="kakao"></div>
                        <div class="tab-content" id="naver"></div>
                        <div class="tab-content" id="google"></div>
                    </div>
                `,
                position: reviewWindowPosition
            });
            reviewInfoWindow.open(map);

            fetchReviews('kakao');
            fetchReviews('naver');
            fetchReviews('google');
        }

        function fetchReviews(source) {
            fetch(`http://127.0.0.1:5000/reviews?source=${source}`)
                .then((response) => response.json())
                .then((data) => {
                    const container = document.getElementById(source);
                    container.innerHTML = data
                        .map(
                            (review) => `
                            <div style="margin-bottom: 10px; border-bottom: 1px solid #ddd; padding: 5px;">
                                <p><b>날짜:</b> ${review.Review_Date}</p>
                                <p><b>리뷰:</b> ${review.Review}</p>
                            </div>
                        `
                        )
                        .join('');
                });
        }

        function showTab(tabId) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');

            tabs.forEach((tab) => {
                tab.classList.remove('active');
            });
            contents.forEach((content) => {
                content.classList.remove('active');
            });

            document.querySelector(`.tab[onclick="showTab('${tabId}')"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }
    </script>
</body>
</html> -->

<!-- <!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>리뷰 페이징 적용</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=b161607ed1a03f4e998f738c9ad3d6cd"></script>
    <style>
        body, html {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100%;
            height: 100%;
        }
        .info-content {
            background-color: #ffffff;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 10px;
            text-align: left;
            width: 400px;
            font-family: Arial, sans-serif;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        }
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
        }
        .tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-bottom: none;
        }
        .tab.active {
            background-color: #ffffff;
            font-weight: bold;
        }
        .tab-content {
            display: none;
            padding: 10px;
            border: 1px solid #ddd;
            border-top: none;
            background-color: #ffffff;
            max-height: 300px;
            overflow-y: auto;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        var mapContainer = document.getElementById('map');
        var mapOption = {
            center: new kakao.maps.LatLng(37.4896537373705, 127.032839070004),
            level: 4
        };
        var map = new kakao.maps.Map(mapContainer, mapOption);

        var restaurantData = [
            {
                name: "뱅뱅막국수 역삼본점",
                lat: 37.48965570000001,
                lng: 127.0328555
            }
        ];

        var reviewInfoWindow = null;

        restaurantData.forEach(function (restaurant) {
            var marker = new kakao.maps.Marker({
                position: new kakao.maps.LatLng(restaurant.lat, restaurant.lng),
                map: map
            });

            kakao.maps.event.addListener(marker, 'click', function () {
                if (reviewInfoWindow) {
                    reviewInfoWindow.close();
                }
                reviewInfoWindow = new kakao.maps.InfoWindow({
                    content: `
                        <div class="info-content">
                            <div class="tabs">
                                <div class="tab active" onclick="showTab('kakao', '${restaurant.name}')">카카오 리뷰</div>
                                <div class="tab" onclick="showTab('naver', '${restaurant.name}')">네이버 리뷰</div>
                                <div class="tab" onclick="showTab('google', '${restaurant.name}')">구글 리뷰</div>
                            </div>
                            <div class="tab-content active" id="kakao"></div>
                            <div class="tab-content" id="naver"></div>
                            <div class="tab-content" id="google"></div>
                        </div>
                    `,
                    position: new kakao.maps.LatLng(restaurant.lat, restaurant.lng + 0.0005)
                });
                reviewInfoWindow.open(map);
                fetchReviews('kakao', restaurant.name, 0); // 기본 탭 데이터 로드
            });
        });

        function fetchReviews(source, restaurantName, page) {
            fetch(`http://127.0.0.1:5000/reviews?source=${source}&page=${page}`)
                .then((response) => response.json())
                .then((data) => {
                    const container = document.getElementById(source);
                    container.innerHTML += data
                        .map(
                            (review) => `
                            <div style="margin-bottom: 10px; border-bottom: 1px solid #ddd; padding: 5px;">
                                <p><b>날짜:</b> ${review.Review_Date}</p>
                                <p><b>리뷰:</b> ${review.Review}</p>
                            </div>
                        `
                        )
                        .join('');

                    // 페이징 추가
                    const loadMoreButton = document.createElement('button');
                    loadMoreButton.innerText = '더보기';
                    loadMoreButton.onclick = () => {
                        loadMoreButton.remove();
                        fetchReviews(source, restaurantName, page + 1);
                    };
                    container.appendChild(loadMoreButton);
                });
        }

        function showTab(tabId, restaurantName) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');

            tabs.forEach((tab) => tab.classList.remove('active'));
            contents.forEach((content) => content.classList.remove('active'));

            document.querySelector(`.tab[onclick="showTab('${tabId}', '${restaurantName}')"]`).classList.add('active');
            const activeContent = document.getElementById(tabId);
            activeContent.classList.add('active');

            if (activeContent.innerHTML.trim() === '') {
                fetchReviews(tabId, restaurantName, 0);
            }
        }
    </script>
</body>
</html> -->


<!-- <!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>카카오맵_리뷰와 분석리포트</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=b161607ed1a03f4e998f738c9ad3d6cd"></script>
    <style>
        body, html {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100%;
            height: 100%;
        }
        .info-content {
            background-color: #ffffff;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 10px;
            text-align: left;
            width: 400px;
            font-family: Arial, sans-serif;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        }
        .info-content h4 {
            margin-bottom: 10px;
            font-size: 18px;
            color: #333;
        }
        .info-content img {
            width: 100%;
            height: auto;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .info-content .details {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }
        .info-content .btn {
            display: inline-block;
            margin-top: 10px;
            padding: 10px 15px;
            background-color: #007BFF;
            color: #ffffff;
            text-align: center;
            font-size: 14px;
            border-radius: 5px;
            text-decoration: none;
            cursor: pointer;
        }
        .info-content .btn:hover {
            background-color: #0056b3;
        }
        .review-container {
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        // 1. 고정된 현위치 설정
        var lat = 37.4896537373705;
        var lng = 127.032839070004;
        var userLocation = new kakao.maps.LatLng(lat, lng);

        // 2. 지도 생성
        var mapContainer = document.getElementById('map');
        var mapOption = {
            center: userLocation,
            level: 4
        };
        var map = new kakao.maps.Map(mapContainer, mapOption);

        // 3. 현위치 마커 표시
        var userMarker = new kakao.maps.Marker({
            position: userLocation,
            map: map
        });

        // 현위치 인포윈도우
        var userInfoWindow = new kakao.maps.InfoWindow({
            content: '<div style="padding:5px;">현위치</div>'
        });
        userInfoWindow.open(map, userMarker);

        // 4. 반경 200m 원 표시
        var circle = new kakao.maps.Circle({
            center: userLocation,
            radius: 200,
            strokeWeight: 2,
            strokeColor: '#FF0000',
            strokeOpacity: 0.8,
            fillColor: '#FF0000',
            fillOpacity: 0.2
        });
        circle.setMap(map);

        // 5. 음식점 데이터
        var restaurantData = [
            {
                name: "뱅뱅막국수 역삼본점",
                type: "국수",
                rating: "4.4",
                lat: 37.48965570000001,
                lng: 127.0328555,
                img: "http://localhost:8080/bangbang_menu.jpg",
                phone: "0507-1392-4848",
                menu: "뱅뱅막국수, 들기름막국수, 육전",
                address: "서울 강남구 도곡로 112 서한빌딩 1층 103호",
                hours: "매일 11:00 ~ 21:00, 매일 휴게시간 15:00 ~ 16:30",
                reviewAnalysis: "http://localhost:8080/bangbang_pos_review.jpg",
                source: "kakao"
            }
        ];

        var activeInfoWindow = null;
        var reviewInfoWindow = null;

        restaurantData.forEach(function (restaurant) {
            var marker = new kakao.maps.Marker({
                position: new kakao.maps.LatLng(restaurant.lat, restaurant.lng),
                map: map
            });

            // 마커 클릭 이벤트
            kakao.maps.event.addListener(marker, 'click', function () {
                if (activeInfoWindow) {
                    activeInfoWindow.close();
                }
                if (reviewInfoWindow) {
                    reviewInfoWindow.close();
                    reviewInfoWindow = null;
                }

                var infoWindow = new kakao.maps.InfoWindow({
                    content: `
                        <div class="info-content">
                            <h4>${restaurant.name}</h4>
                            <div>⭐ ${restaurant.rating}</div>
                            <img src="${restaurant.img}" alt="${restaurant.name}">
                            <div class="details">
                                <div><b>업종:</b> ${restaurant.type}</div>
                                <div><b>전화번호:</b> ${restaurant.phone}</div>
                                <div><b>대표 메뉴:</b> ${restaurant.menu}</div>
                                <div><b>주소:</b> ${restaurant.address}</div>
                                <div><b>영업시간:</b> ${restaurant.hours}</div>
                                <a class="btn" onclick="showReviewAnalysis(${restaurant.lat}, ${restaurant.lng}, '${restaurant.reviewAnalysis}')">분석리포트 보기</a>
                                <a class="btn" onclick="showAllReviews(${restaurant.lat}, ${restaurant.lng}, '${restaurant.source}')">리뷰모아보기</a>
                            </div>
                        </div>
                    `
                });
                infoWindow.open(map, marker);
                activeInfoWindow = infoWindow;
            });
        });

        function showAllReviews(lat, lng, source) {
            fetch(`http://127.0.0.1:5000/reviews?source=${source}`)
                .then((response) => response.json())
                .then((data) => {
                    let reviewsHtml = `
                        <div style="text-align: right; cursor: pointer;" onclick="if(reviewInfoWindow) reviewInfoWindow.close();">❌</div>
                        <h4>${source.toUpperCase()} 리뷰 모아보기</h4>
                    `;
                    if (data.length === 0) {
                        reviewsHtml += `<p>리뷰가 없습니다.</p>`;
                    } else {
                        reviewsHtml += `
                            <div class="review-container">
                                ${generateReviewHTML(data.slice(0, 10))}
                            </div>
                        `;
                    }

                    var reviewWindowPosition = new kakao.maps.LatLng(lat, lng + 0.0007);
                    reviewInfoWindow = new kakao.maps.InfoWindow({
                        content: `
                            <div class="info-content" style="width: 400px;">
                                ${reviewsHtml}
                            </div>
                        `
                    });
                    reviewInfoWindow.open(map);

                    // Scroll event for pagination
                    const reviewContainer = document.querySelector('.review-container');
                    if (reviewContainer) {
                        let currentPage = 1;
                        reviewContainer.addEventListener('scroll', function () {
                            if (reviewContainer.scrollTop + reviewContainer.clientHeight >= reviewContainer.scrollHeight) {
                                currentPage++;
                                const startIndex = (currentPage - 1) * 10;
                                const endIndex = startIndex + 10;
                                const nextReviews = data.slice(startIndex, endIndex);
                                if (nextReviews.length > 0) {
                                    reviewContainer.innerHTML += generateReviewHTML(nextReviews);
                                }
                            }
                        });
                    }
                })
                .catch((error) => console.error('리뷰 데이터를 가져오는 중 오류 발생:', error));
        }

        function generateReviewHTML(reviews) {
            return reviews
                .map(
                    (review) => `
                    <div style="margin-bottom: 10px; border-bottom: 1px solid #ddd; padding: 5px;">
                        <p><b>날짜:</b> ${review.Review_Date}</p>
                        <p><b>리뷰:</b> ${review.Review}</p>
                    </div>
                `
                )
                .join('');
        }

        function showReviewAnalysis(lat, lng, reviewImg) {
            if (reviewInfoWindow) {
                reviewInfoWindow.close();
            }

            var reviewWindowPosition = new kakao.maps.LatLng(lat, lng + 0.0005);
            reviewInfoWindow = new kakao.maps.InfoWindow({
                content: `
                    <div class="info-content">
                        <div style="text-align: right; cursor: pointer;" onclick="if(reviewInfoWindow) reviewInfoWindow.close();">❌</div>
                        <h4>리뷰 분석 리포트</h4>
                        <img src="${reviewImg}" alt="리뷰 분석">
                    </div>
                `
            });
            reviewInfoWindow.open(map);
        }
    </script>
</body>
</html> -->


<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>카카오맵_리뷰와 분석리포트</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=b161607ed1a03f4e998f738c9ad3d6cd"></script>
    <style>
        body, html {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100%;
            height: 100%;
        }
        .info-content {
            background-color: #ffffff;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 10px;
            text-align: left;
            width: 300px;
            font-family: Arial, sans-serif;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        }
        .info-content h4 {
            margin-bottom: 10px;
            font-size: 18px;
            color: #333;
        }
        .info-content img {
            width: 100%;
            height: auto;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .info-content .details {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }
        .info-content .btn {
            display: inline-block;
            margin-top: 10px;
            padding: 10px 15px;
            background-color: #007BFF;
            color: #ffffff;
            text-align: center;
            font-size: 14px;
            border-radius: 5px;
            text-decoration: none;
            cursor: pointer;
        }
        .info-content .btn:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        // 1. 고정된 현위치 설정
        var lat = 37.4896537373705;
        var lng = 127.032839070004;
        var userLocation = new kakao.maps.LatLng(lat, lng);

        // 2. 지도 생성
        var mapContainer = document.getElementById('map');
        var mapOption = {
            center: userLocation,
            level: 4
        };
        var map = new kakao.maps.Map(mapContainer, mapOption);

        // 3. 현위치 마커 표시
        var userMarker = new kakao.maps.Marker({
            position: userLocation,
            map: map
        });

        // 현위치 인포윈도우
        var userInfoWindow = new kakao.maps.InfoWindow({
            content: '<div style="padding:5px;">현위치</div>'
        });
        userInfoWindow.open(map, userMarker);

        // 4. 반경 200m 원 표시
        var circle = new kakao.maps.Circle({
            center: userLocation,
            radius: 200,
            strokeWeight: 2,
            strokeColor: '#FF0000',
            strokeOpacity: 0.8,
            fillColor: '#FF0000',
            fillOpacity: 0.2
        });
        circle.setMap(map);

        // 5. 음식점 데이터
        var restaurantData = [
            {
                name: "뱅뱅막국수 역삼본점",
                type: "국수",
                rating: "4.4",
                lat: 37.48965570000001,
                lng: 127.0328555,
                img: "http://localhost:8080/bangbang_menu.jpg",
                phone: "0507-1392-4848",
                menu: "뱅뱅막국수, 들기름막국수, 육전",
                address: "서울 강남구 도곡로 112 서한빌딩 1층 103호",
                hours: "매일 11:00 ~ 21:00, 매일 휴게시간 15:00 ~ 16:30",
                reviewAnalysis: "http://localhost:8080/bangbang_pos_review.jpg",
                source: "kakao"
            }
        ];

        var activeInfoWindow = null;
        var reviewInfoWindow = null;

        restaurantData.forEach(function (restaurant) {
            var marker = new kakao.maps.Marker({
                position: new kakao.maps.LatLng(restaurant.lat, restaurant.lng),
                map: map
            });

            // 마커 클릭 이벤트
            kakao.maps.event.addListener(marker, 'click', function () {
                if (activeInfoWindow) {
                    activeInfoWindow.close();
                }
                if (reviewInfoWindow) {
                    reviewInfoWindow.close();
                    reviewInfoWindow = null;
                }

                var infoWindow = new kakao.maps.InfoWindow({
                    content: `
                        <div class="info-content">
                            <h4>${restaurant.name}</h4>
                            <div>⭐ ${restaurant.rating}</div>
                            <img src="${restaurant.img}" alt="${restaurant.name}">
                            <div class="details">
                                <div><b>업종:</b> ${restaurant.type}</div>
                                <div><b>전화번호:</b> ${restaurant.phone}</div>
                                <div><b>대표 메뉴:</b> ${restaurant.menu}</div>
                                <div><b>주소:</b> ${restaurant.address}</div>
                                <div><b>영업시간:</b> ${restaurant.hours}</div>
                                <a class="btn" onclick="showReviewAnalysis(${restaurant.lat}, ${restaurant.lng}, '${restaurant.reviewAnalysis}')">분석리포트 보기</a>
                                <a class="btn" onclick="showAllReviews(${restaurant.lat}, ${restaurant.lng}, '${restaurant.source}')">리뷰모아보기</a>
                            </div>
                        </div>
                    `
                });
                infoWindow.open(map, marker);
                activeInfoWindow = infoWindow;
            });
        });

        function showReviewAnalysis(lat, lng, reviewImg) {
            if (reviewInfoWindow) {
                reviewInfoWindow.close();
            }

            // InfoWindow를 마커 바로 옆에 표시
            var reviewWindowPosition = new kakao.maps.LatLng(lat, lng + 0.0001); // 위도로 약간 이동
            reviewInfoWindow = new kakao.maps.InfoWindow({
                content: `
                    <div class="info-content" style="max-width: 300px; text-align: center;">
                        <div style="text-align: right; cursor: pointer;" onclick="if(reviewInfoWindow) reviewInfoWindow.close();">❌</div>
                        <h4>리뷰 분석 리포트</h4>
                        <img src="${reviewImg}" alt="리뷰 분석" style="max-width: 100%; height: auto;">
                    </div>
                `
            });
            reviewInfoWindow.setPosition(reviewWindowPosition); // 위치 조정
            reviewInfoWindow.open(map);
        }

        function showAllReviews(lat, lng, source) {
            fetch(`http://127.0.0.1:5000/reviews?source=${source}`)
                .then((response) => response.json())
                .then((data) => {
                    let reviewsHtml = `
                        <div style="text-align: right; cursor: pointer;" onclick="if(reviewInfoWindow) reviewInfoWindow.close();">❌</div>
                        <h4>${source.toUpperCase()} 리뷰 모아보기</h4>
                    `;
                    if (data.length === 0) {
                        reviewsHtml += `<p>리뷰가 없습니다.</p>`;
                    } else {
                        reviewsHtml += `
                            <div class="review-container">
                                ${generateReviewHTML(data.slice(0, 10))}
                            </div>
                        `;
                    }

                    var reviewWindowPosition = new kakao.maps.LatLng(lat, lng + 0.0001); // 마커 옆으로 위치
                    reviewInfoWindow = new kakao.maps.InfoWindow({
                        content: `
                            <div class="info-content" style="max-width: 300px;">
                                ${reviewsHtml}
                            </div>
                        `
                    });
                    reviewInfoWindow.setPosition(reviewWindowPosition); // 위치 조정
                    reviewInfoWindow.open(map);
                })
                .catch((error) => console.error('리뷰 데이터를 가져오는 중 오류 발생:', error));
        }

        function generateReviewHTML(reviews) {
            return reviews
                .map(
                    (review) => `
                    <div style="margin-bottom: 10px; border-bottom: 1px solid #ddd; padding: 5px;">
                        <p><b>날짜:</b> ${review.Review_Date}</p>
                        <p><b>리뷰:</b> ${review.Review}</p>
                    </div>
                `
                )
                .join('');
        }
    </script>
</body>
</html>


